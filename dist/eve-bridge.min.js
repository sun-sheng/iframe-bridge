!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof exports?module.exports=n():e.eveBridge=n()}(this,function(){function e(e){return"undefined"!=typeof e}function n(e){return null!==e&&"object"==typeof e}function r(e){return"number"==typeof e}function t(e){return"function"==typeof e}var i=Array.isArray,a={each:function(r,t){var a;if(n(r)){var o;for(o in r)r.hasOwnProperty(o)&&(a=r[o],t(a,o))}else if(i(r)){var u=0,c=r.length;for(u;c>u;u++)a=r[u],e(a)&&t(a,u)}},some:function(r,t){if(n(r)){var a;for(a in r)if(r.hasOwnProperty(a)&&t(r[a],a))return!0}else if(i(r)){var o=0,u=r.length;for(o;u>o;o++)if(e(r[o])&&t(r[o],o))return!0}return!1},object:{contain:function(e,r){if(!n(e)||!n(r))return!1;var t=a.some(r,function(n,r){return n!==e[r]?!0:void 0});return!t}},array:{reverseEach:function(n,r){if(!i(n))return!1;for(var t,a=n.length;a--;)t=n[a],e(t)&&r(t,a)},remove:function(e,i){var o=-1;r(i)?o=i:(n(i)||t(i))&&(o=a.array.indexOf(e,i)),o>-1&&e.splice(o,1)},removeAll:function(e,r){if(!n(r)&&!t(r))return!1;var i=a.array.indexOf(e,r);return i>-1?(e.splice(i,1),void a.array.removeAll(e,r)):!0},indexOf:function(e,r){for(var i,o=e.length,u=-1;o--;)if(i=e[o],n(r)){if(a.object.contain(i,r)){u=o;break}}else if(t(r)&&r(i,o)){u=o;break}return u}}};a.array.each=a.each,a.array.some=a.some;var o=[],u=0,c={timeout:{code:"timeout",msg:"EVE 服务调用超时"}},f="_success",m="_error",s=function(e){var n=e.data;a.array.reverseEach(o,function(e,r){e.eid===n.eid&&(e._timeout&&clearTimeout(e._timeout),t(e.callback)&&e.callback(n.result),e.once&&(a.array.remove(o,r),e.sibling_eid&&a.array.remove(o,{eid:e.sibling_eid})))})};return window.addEventListener("message",s,!1),{parentFrame:window.parent,timeout:15e3,config:function(e){e.parentFrame&&(this.parentFrame=e.parentFrame),e.timeout&&(this.timeout=e.timeout)},call:function(e,n,r,t){var i=e+u++,s=i+f,l=i+m;this.parentFrame.postMessage({eid:i,name:e,options:t},"*");var d=t&&t.timeout||this.timeout,v=setTimeout(function(){r(c.timeout),a.array.removeAll(o,{_timeout:v})},d);o.push({eid:s,sibling_eid:l,name:e,once:!0,callback:n,_timeout:v}),o.push({eid:l,sibling_eid:s,name:e,once:!0,callback:r,_timeout:v})},once:function(e,n){o.push({eid:e,name:e,once:!0,callback:n})},bind:function(e,n){o.push({eid:e,name:e,callback:n})},unbind:function(e,n){a.array.remove(o,{name:e,callback:n})}}});